# 数据库设计 - 汇总（v3 重设计）

## 全局约定
- 范围隔离：所有业务表增加 `store_id` 字段实现门店/租户级数据隔离
- 审计与并发：统一 `create_time`、`update_time`、`is_deleted`（可选）、`version`（乐观锁）
- 主键：BIGINT 雪花ID；金额 DECIMAL(12,2)；JSON 字段用于可变规则
- 索引：按高频查询建立复合索引（如 `idx_user_time`、`idx_store_status`）
- 关系：订单→支付/退款→消费记录；用户→会员/积分/钱包；机位→会话→订单（上机）

## 模块与脚本
- 用户：`../modules/user/db.sql`
- 会员：`../modules/member/db.sql`
- 积分：`../modules/points/db.sql`
- 商品：`../modules/goods/db.sql`
- 套餐：`../modules/package-套餐/db.sql`
- 订单：`../modules/order/db.sql`
- 钱包：`../modules/wallet/db.sql`
- 余额/消费：`../modules/balance/db.sql`
- 库存耗材：`../modules/inventory-耗材/db.sql`
- 活动：`../modules/campaign/db.sql`
- 楼层/区域/机位/会话：`../modules/floor/db.sql`、`../modules/seat/db.sql`
- 支付桥接/设备桥接：`../modules/pay-bridge/db.sql`、`../modules/device-bridge/db.sql`
- 认证与权限：`../modules/auth/db.sql`、`../modules/permission/db.sql`
- 基础服务：`../modules/base-service/db.sql`
- 统计：`../modules/stats/db.sql`

## 关键表说明（摘录）
- `order_master`：订单主表，含类型、来源、支付字段，关联机位与用户
- `seat_session`：上机会话明细，形成“设备控制→计费→订单”的闭环
- `wallet_ledger` 与 `points_ledger`：严格记账流水，便于审计与对账
- `user_package` 与 `package_redeem`：套餐持有与核销闭环

## 迁移建议
- 初始化按模块执行 `db.sql`；后续版本通过 Flyway/Liquibase 管理增量

— 完 —