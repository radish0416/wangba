-- 订单模块（小驼峰+审计与扩展）

CREATE TABLE `order_master` (
  `id` BIGINT NOT NULL COMMENT '主键ID',
  `storeId` BIGINT NOT NULL DEFAULT 0 COMMENT '门店/租户ID',
  `userId` BIGINT NOT NULL COMMENT '用户ID',
  `orderType` TINYINT NOT NULL COMMENT '订单类型 1上机 2商品 3套餐',
  `status` TINYINT NOT NULL COMMENT '状态 0待支付 1已支付 2已取消 3已退款 4已关闭',
  `totalAmount` DECIMAL(12,2) NOT NULL COMMENT '订单总额',
  `discountAmount` DECIMAL(12,2) NOT NULL DEFAULT 0.00 COMMENT '折扣金额',
  `payAmount` DECIMAL(12,2) NOT NULL DEFAULT 0.00 COMMENT '实付金额',
  `payChannel` TINYINT NOT NULL DEFAULT 0 COMMENT '支付渠道 0未知 1微信 2支付宝 3钱包',
  `payTime` DATETIME NULL COMMENT '支付时间',
  `externalNo` VARCHAR(64) NOT NULL DEFAULT '' COMMENT '外部支付单号',
  `seatId` BIGINT NOT NULL DEFAULT 0 COMMENT '机位ID（上机订单）',
  `sourceChannel` TINYINT NOT NULL DEFAULT 1 COMMENT '来源渠道 1后台 2小程序',
  `remark` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '备注',
  `createBy` BIGINT NOT NULL DEFAULT 0 COMMENT '创建人ID',
  `createTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updateBy` BIGINT NOT NULL DEFAULT 0 COMMENT '修改人ID',
  `updateTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `ext1` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段1',
  `ext2` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段2',
  `ext3` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段3',
  `ext4` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段4',
  `ext5` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段5',
  PRIMARY KEY (`id`),
  KEY `idx_user_time` (`userId`,`createTime`),
  KEY `idx_store_status` (`storeId`,`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单主表';

CREATE TABLE `order_item` (
  `id` BIGINT NOT NULL COMMENT '主键ID',
  `orderId` BIGINT NOT NULL COMMENT '订单ID',
  `skuId` BIGINT NOT NULL DEFAULT 0 COMMENT 'SKU ID',
  `title` VARCHAR(128) NOT NULL COMMENT '项目标题',
  `quantity` INT NOT NULL DEFAULT 1 COMMENT '数量',
  `price` DECIMAL(10,2) NOT NULL COMMENT '单价',
  `amount` DECIMAL(12,2) NOT NULL COMMENT '金额',
  `createBy` BIGINT NOT NULL DEFAULT 0 COMMENT '创建人ID',
  `createTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updateBy` BIGINT NOT NULL DEFAULT 0 COMMENT '修改人ID',
  `updateTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `ext1` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段1',
  `ext2` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段2',
  `ext3` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段3',
  `ext4` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段4',
  `ext5` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段5',
  PRIMARY KEY (`id`),
  KEY `idx_order` (`orderId`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单明细';

CREATE TABLE `order_payment` (
  `id` BIGINT NOT NULL COMMENT '主键ID',
  `orderId` BIGINT NOT NULL COMMENT '订单ID',
  `payChannel` TINYINT NOT NULL COMMENT '支付渠道 1微信 2支付宝 3钱包',
  `outTradeNo` VARCHAR(64) NOT NULL COMMENT '商户订单号',
  `tradeNo` VARCHAR(64) NOT NULL DEFAULT '' COMMENT '第三方交易号',
  `status` TINYINT NOT NULL COMMENT '状态 0创建 1成功 2关闭 3退款',
  `amount` DECIMAL(12,2) NOT NULL COMMENT '支付金额',
  `notifyPayload` JSON NULL COMMENT '回调负载JSON',
  `payTime` DATETIME NULL COMMENT '支付时间',
  `createBy` BIGINT NOT NULL DEFAULT 0 COMMENT '创建人ID',
  `createTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updateBy` BIGINT NOT NULL DEFAULT 0 COMMENT '修改人ID',
  `updateTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `ext1` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段1',
  `ext2` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段2',
  `ext3` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段3',
  `ext4` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段4',
  `ext5` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段5',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_out_trade_no` (`outTradeNo`),
  KEY `idx_order` (`orderId`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单支付记录';

CREATE TABLE `order_refund` (
  `id` BIGINT NOT NULL COMMENT '主键ID',
  `orderId` BIGINT NOT NULL COMMENT '订单ID',
  `amount` DECIMAL(12,2) NOT NULL COMMENT '退款金额',
  `status` TINYINT NOT NULL COMMENT '状态 0申请 1成功 2关闭',
  `reason` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '退款原因',
  `createBy` BIGINT NOT NULL DEFAULT 0 COMMENT '创建人ID',
  `createTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updateBy` BIGINT NOT NULL DEFAULT 0 COMMENT '修改人ID',
  `updateTime` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `ext1` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段1',
  `ext2` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段2',
  `ext3` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段3',
  `ext4` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段4',
  `ext5` VARCHAR(255) NOT NULL DEFAULT '' COMMENT '扩展字段5',
  PRIMARY KEY (`id`),
  KEY `idx_order` (`orderId`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单退款';